1. Компоненты системы

API — принимает запросы от других сервисов

База данных — хранит все уведомления с их статусами (главный источник правды)

RabbitMQ — очередь для передачи задач между компонентами

Фоновый воркер — обрабатывает и отправляет уведомления

2. Создание уведомления (POST /notify)
   Получаем запрос с текстом, временем отправки и адресом получателя

Сразу сохраняем в БД со статусом SCHEDULED

Кладём ID уведомления в RabbitMQ с задержкой до времени отправки

3. Обработка уведомлений (Фоновый воркер)
   Воркер ждёт сообщения из RabbitMQ

Когда наступает время, получает ID уведомления

По ID забирает данные из БД (текст, адрес получателя)

Отправляет сообщение во внешний сервис (Telegram, email и т.д.)

Обновляет статус в БД:

Успех → SENT

Ошибка → кладёт сообщение обратно в очередь с задержкой (10 сек, 40 сек, 90 сек)

После нескольких ошибок → FAILED

4. Проверка и отмена
   GET /notify/{id} → берём текущий статус из БД

DELETE /notify/{id} → меняем статус в БД на CANCELLED (воркер увидит этот статус и ничего не отправит)

Главные принципы:
БД первична — всё состояние хранится там

Очередь временная — только для передачи задач между частями сервиса

Воркер отправляет — он делает реальные вызовы к Telegram/email API

Повторы с задержкой — при ошибках уведомления отправляются повторно с увеличивающимися интервалами